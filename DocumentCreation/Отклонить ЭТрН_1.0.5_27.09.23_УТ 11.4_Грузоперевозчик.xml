<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КолонкаИсточника</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Отклонить ЭТрН</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">DR_Документы</Value>
		<Value xsi:type="xs:string">Если ЗначениеЗаполнено(Источник) Тогда 

	ПродолжитьОбработку = Истина;
	
	Если Не Источник.ВидДокумента = ПолучитьЗначение_Перечисления("ВидыДокументов","ON_TRNACLGROT_Входящий") Тогда
		ПродолжитьОбработку = Ложь;
	КонецЕсли;

	Если Не Источник.Статус = ПолучитьЗначение_Перечисления("Статусы","Обработан") И Не Источник.Статус = ПолучитьЗначение_Перечисления("Статусы","УспешноОбработанГИСЭПД") Тогда
		ПродолжитьОбработку = Ложь;
	КонецЕсли;
	
	//+Если один из документов цепочки не принят ГИС. Обработка запрещена 
	Если ПродолжитьОбработку = Истина Тогда
		ВсеДокументыЦепочкиПоСтроке = Новый Массив;
		СписокДокументовЦепочкиСервер(Источник, ВсеДокументыЦепочкиПоСтроке, "СписокДляГрузоперевозчика");  

		Для Каждого ДокументЦепочки Из ВсеДокументыЦепочкиПоСтроке Цикл     
			Если ТипЗнч(ДокументЦепочки.Документ.Ссылка) = Тип("ДокументСсылка.DR_Документы") Тогда
				Если Найти(ДокументЦепочки.Документ.Статус, "ОбработанСОшибкойГИСЭПД") Тогда
					ПродолжитьОбработку = Ложь;
					ЛогСобытий = "Получен отрицательный статус от ГИС ЭПД. Дальнейшая работа с цепочкой запрещена. Необходимо сформировать новую цепочку документов";
					Прервать;	
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;                            
	КонецЕсли; 
	//-

	//Основные реквизиты документа
	Приемник.ВидДокумента = ПолучитьЗначение_Перечисления("ВидыДокументов","DP_UVUTOCH_Исходящий");
	ИмяФайла = "DP_UVUTOCH";
	
	Если ПродолжитьОбработку Тогда

		ТЗ_УчастникиОбмена = DR_УчастникиОбмена.Выгрузить();
		
		Приемник.Дата = ТекущаяДата();
		Приемник.ДанныеЭЦП = Источник.ДанныеЭЦП; 
		
		ТЧДопРеквизиты = Источник.ДополнительныеРеквизиты.Выгрузить();
		
		//Дополнительные реквизиты документа	
		СписокРеквизитов = Новый Соответствие;
		СписокРеквизитов.Вставить("Организация", 				ВернутьЗначениеДопРеквизитаИзДокумента("Организация", ТЧДопРеквизиты));
	    СписокРеквизитов.Вставить("Грузоотправитель", 			ВернутьЗначениеДопРеквизитаИзДокумента("Грузоотправитель", ТЧДопРеквизиты));
		СписокРеквизитов.Вставить("Грузополучатель", 			ВернутьЗначениеДопРеквизитаИзДокумента("Грузополучатель", ТЧДопРеквизиты));
		СписокРеквизитов.Вставить("Грузоперевозчик", 			ВернутьЗначениеДопРеквизитаИзДокумента("Грузоперевозчик", ТЧДопРеквизиты));
		СписокРеквизитов.Вставить("Заказчик", 					ВернутьЗначениеДопРеквизитаИзДокумента("Заказчик", ТЧДопРеквизиты));
		СписокРеквизитов.Вставить("ВидДокумента", 				Приемник.ВидДокумента);
		СписокРеквизитов.Вставить("РольУчастникаОбмена", 		"Грузоперевозчик"); 
		СписокРеквизитов.Вставить("ИдентификаторОснования", 	Источник.ИдентификаторДокумента);
		СписокРеквизитов.Вставить("ТранспортнаяНакладнаяНомер", ВернутьЗначениеДопРеквизитаИзДокумента("ТранспортнаяНакладнаяНомер", ТЧДопРеквизиты));
		СписокРеквизитов.Вставить("ТранспортнаяНакладнаяДата",  ВернутьЗначениеДопРеквизитаИзДокумента("ТранспортнаяНакладнаяДата", ТЧДопРеквизиты));
			
		//Получаем GUID участников обмена 	
		
		xmlГрузополучатель  = ВернутьЗначениеДопРеквизитаИзДокумента("xmlГрузополучатель", ТЧДопРеквизиты);
		xmlГрузоотправитель = ВернутьЗначениеДопРеквизитаИзДокумента("xmlГрузоотправитель", ТЧДопРеквизиты);
		xmlГрузоперевозчик  = ВернутьЗначениеДопРеквизитаИзДокумента("xmlГрузоперевозчик", ТЧДопРеквизиты);
		
		СписокРеквизитов.Вставить("xmlОрганизация", 			ВернутьЗначениеДопРеквизитаИзДокумента("xmlОрганизация", ТЧДопРеквизиты));
	    СписокРеквизитов.Вставить("xmlГрузоотправитель", 		xmlГрузоотправитель);
		СписокРеквизитов.Вставить("xmlГрузополучатель", 		xmlГрузополучатель);
		СписокРеквизитов.Вставить("xmlГрузоперевозчик", 		xmlГрузоперевозчик);
		СписокРеквизитов.Вставить("xmlЗаказчик", 				ВернутьЗначениеДопРеквизитаИзДокумента("xmlЗаказчик", ТЧДопРеквизиты));	                  
		
		Для Каждого Запись из СписокРеквизитов Цикл
			НоваяЗапись = Приемник.ДополнительныеРеквизиты.Добавить();
			
			НоваяЗапись.Реквизит = Запись.Ключ;
			НоваяЗапись.Значение = Запись.Значение;
		КонецЦикла;
		
		GUIDФайла = Новый УникальныйИдентификатор;
		ИдентификаторФайла        = ИмяФайла + "_" + xmlГрузоотправитель + "_" + xmlГрузоперевозчик + "_" + Формат(ТекущаяДата(), "ДФ=yyyyMMdd") + "_" + GUIDФайла;
		Приемник.ИдентификаторДокумента = ИдентификаторФайла;
			
		Приемник.ПередЗаписьюПроверка();          
	          
		Приемник.Записать();
	
	КонецЕсли;
	
КонецЕсли;</Value>
		<Value xsi:type="xs:string">DP_UVUTOCH</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:string">Документ_Основание</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">ДополнительныйПолучатель</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоперевозчик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузополучатель</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоотправитель</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Отклонить ЭТрН</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
	</row>
</ValueTree>