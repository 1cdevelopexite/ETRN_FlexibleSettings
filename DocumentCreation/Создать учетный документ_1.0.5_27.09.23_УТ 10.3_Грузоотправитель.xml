<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КолонкаИсточника</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">СлужебныеТекст</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Формула</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Создать учетный документ</Value>
		<Value xsi:type="xs:string">ДокументЭТРН</Value>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">ПоступлениеТоваровУслуг</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:nil="true"/>
		<Value xsi:nil="true"/>
		<Value xsi:type="xs:string"/>
		<Value xsi:type="xs:string">ПродолжитьОбработку = Истина;

Если Не Источник.ВидДокумента = ПолучитьЗначение_Перечисления("ВидыДокументов", "ON_TRNPUDPER_Входящий") Тогда
	ПродолжитьОбработку = Ложь;
КонецЕсли;
	
Если Не Источник.Статус = ПолучитьЗначение_Перечисления("Статусы","Обработан") И Не Источник.Статус = ПолучитьЗначение_Перечисления("Статусы","УспешноОбработанГИСЭПД") Тогда
	ПродолжитьОбработку = Ложь;
КонецЕсли;
	
Если ПродолжитьОбработку Тогда

    ТЧДопРеквизиты = Источник.ДополнительныеРеквизиты.Выгрузить();

	Приемник.Дата = ТекущаяДата();         
	Приемник.Организация = ВернутьЗначениеДопРеквизитаИзДокумента("Организация", ТЧДопРеквизиты); 
	Приемник.Контрагент = ВернутьЗначениеДопРеквизитаИзДокумента("Грузоперевозчик", ТЧДопРеквизиты); 
	Приемник.ДоговорКонтрагента = Приемник.Контрагент.ОсновнойДоговорКонтрагента;  
	Приемник.УчитыватьНДС = Истина;
	
	Запрос = Новый Запрос;  
	Запрос.Текст ="ВЫБРАТЬ
	              |	DR_Настройки.Ссылка КАК Ссылка,
	              |	DR_НастройкиДополнительныеРеквизиты.Идентификатор КАК Идентификатор
	              |ПОМЕСТИТЬ ВТ_Иденификатор
	              |ИЗ
	              |	Справочник.DR_Настройки КАК DR_Настройки
	              |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_НастройкиДополнительныеРеквизиты
	              |		ПО (DR_Настройки.Ссылка = DR_НастройкиДополнительныеРеквизиты.Ссылка)
	              |			И (DR_НастройкиДополнительныеРеквизиты.Реквизит = ""Ссылка"")
	              |			И (DR_НастройкиДополнительныеРеквизиты.Значение = &amp;Организация)
	              |ГДЕ
	              |	DR_Настройки.ВидНастройки = ""УЧАСТНИКИ_ОБМЕНА""
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ
	              |	DR_НастройкиДополнительныеРеквизиты.Реквизит КАК Реквизит,
	              |	DR_НастройкиДополнительныеРеквизиты.ХранилищеЗначения КАК ХранилищеЗначения
	              |ИЗ
	              |	ВТ_Иденификатор КАК ВТ_Иденификатор
	              |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.DR_Настройки.ДополнительныеРеквизиты КАК DR_НастройкиДополнительныеРеквизиты
	              |		ПО ВТ_Иденификатор.Ссылка = DR_НастройкиДополнительныеРеквизиты.Ссылка
	              |			И ВТ_Иденификатор.Идентификатор = DR_НастройкиДополнительныеРеквизиты.Идентификатор
	              |			И (DR_НастройкиДополнительныеРеквизиты.Реквизит = ""Услуги"")";

	Запрос.УстановитьПараметр("Организация", Приемник.Организация);
	РезультатЗапроса = Запрос.Выполнить();
	  
	Результат = РезультатЗапроса.Выгрузить();
	ТЧУслуги = Неопределено;
	
	Если Результат.Количество() = 0 Тогда
		ЛогСобытий = "У организации " + Приемник.Организация + " в настройках модуля не заполнена таблица услуг";
	КонецЕсли;

	Для Каждого Строка Из Результат Цикл
		
		ТЧУслуги = Строка.ХранилищеЗначения.Получить();
		
		Если ТЧУслуги.Количество() = 0 Тогда
			ЛогСобытий = "У организации " + Приемник.Организация + " в настройках модуля не заполнена таблица услуг";
		Иначе
		
			НалСтВх = ВернутьЗначениеДопРеквизитаИзДокумента("НалСт", ТЧДопРеквизиты);
			НДСНайден = Ложь;
		
			//Ищем услугу с подходящей ставкой
			Для Каждого СтрСтавка Из ТЧУслуги Цикл
				НДССтрокой = СтавкаНДССтрокой(СтрСтавка.СтавкаНДС);
				Если НДССтрокой = НалСтВх Тогда
					
					НоваяСтрока = Приемник.Услуги.Добавить();
					НоваяСтрока.Номенклатура = СтрСтавка.Номенклатура; 
					НоваяСтрока.Содержание = "Услуга перевозки";
					НоваяСтрока.Количество = 1;
					НоваяСтрока.СтавкаНДС = СтрСтавка.СтавкаНДС;   
					НоваяСтрока.Сумма = ВернутьЗначениеДопРеквизитаИзДокумента("СтТовУчНал", ТЧДопРеквизиты);
					НоваяСтрока.Цена = НоваяСтрока.Сумма; 
					
					Приемник.Записать();   
	
					DR_Документ = Источник.ПолучитьОбъект();
					
					НайденаяСтрока = DR_Документ.ДополнительныеРеквизиты.Найти("Документ1С", "Реквизит");
					Если НайденаяСтрока = Неопределено Тогда 
						НайденаяСтрока = DR_Документ.ДополнительныеРеквизиты.Добавить();	
					КонецЕсли;
							
					НайденаяСтрока.Реквизит = "Документ1С";
					НайденаяСтрока.Значение = Приемник.Ссылка;	
					
					DR_Документ.Записать();
					НДСНайден = Истина;
					
				КонецЕсли;
			КонецЦикла;
			
			Если НДСНайден = Ложь Тогда
				ЛогСобытий = "Не найдена ставка НДС " + НалСтВх + " из входящего т5 в услугах организации"
			КонецЕсли;

		КонецЕсли;
				
	КонецЦикла; 	 
	          	
Иначе
	//Сообщить("Нет основания для отражения в учете");
	ЛогСобытий = "Нет основания для отражения в учете";
КонецЕсли;

</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">ДополнительныйПолучатель</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоперевозчик</value>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузополучатель</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоотправитель</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Создать учетный документ</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
	</row>
</ValueTree>