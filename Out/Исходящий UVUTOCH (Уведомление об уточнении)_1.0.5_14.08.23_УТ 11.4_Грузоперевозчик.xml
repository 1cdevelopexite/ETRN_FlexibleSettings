<ValueTree xmlns="http://v8.1c.ru/8.1/data/core" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="ValueTree">
	<column>
		<Name xsi:type="xs:string">Использовать</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ТипТранзакции</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Источник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Приемник</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Служебные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Атрибуты</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Данные</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ДанныеЗначения</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">ДоступныеЗначения</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Связи</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Сохранение</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Загрузка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Обязательный</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">Кнопка</Name>
		<ValueType/>
	</column>
	<column>
		<Name xsi:type="xs:string">КоллекцияТЧ</Name>
		<ValueType/>
	</column>
	<row>
		<row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ЮЛ</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">8</lastId>
						<item>
							<value xsi:type="xs:string">НаимОрг</value>
							<presentation>Документ.НаимОргПЕР</presentation>
							<id xsi:type="xs:decimal">6</id>
						</item>
						<item>
							<value xsi:type="xs:string">ИННЮЛ</value>
							<presentation>Документ.ИННПЕР</presentation>
							<id xsi:type="xs:decimal">7</id>
						</item>
						<item>
							<value xsi:type="xs:string">КПП</value>
							<presentation>Документ.КПППЕР</presentation>
							<id xsi:type="xs:decimal">8</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">УчастЭДО</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">3</lastId>
					<item>
						<value xsi:type="xs:string">ИдУчастЭДО</value>
						<presentation>Документ.xmlГрузоперевозчик</presentation>
						<id xsi:type="xs:decimal">3</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">false</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
			</row>
			<row>
				<row>
					<row>
						<Value xsi:type="xs:boolean">true</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="xs:string">ЭППолФайл</Value>
						<Value xsi:nil="true"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:string">Документ.ЭППолФайл</Value>
						<Value xsi:type="ValueTable"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:decimal">0</Value>
						<Value xsi:type="xs:boolean">false</Value>
						<Value xsi:type="xs:string"/>
						<Value xsi:type="ValueListType">
							<valueType/>
							<lastId xsi:type="xs:decimal">-1</lastId>
						</Value>
					</row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">СведПолФайл</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">2</lastId>
						<item>
							<value xsi:type="xs:string">ИмяПолФайла</value>
							<presentation>Документ.ИдентификаторОснования</presentation>
							<id xsi:type="xs:decimal">2</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ТекстУведУточ</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:string">Документ.ТекстУведУточ</Value>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<row>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ДанПолучДок</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">5</lastId>
						<item>
							<value xsi:type="xs:string">НаимДок</value>
							<presentation>Документ.НаимДок</presentation>
							<id xsi:type="xs:decimal">3</id>
						</item>
						<item>
							<value xsi:type="xs:string">НомСФ</value>
							<presentation>Документ.НомСФ</presentation>
							<id xsi:type="xs:decimal">4</id>
						</item>
						<item>
							<value xsi:type="xs:string">ДатаСФ</value>
							<presentation>Документ.ДатаСФ</presentation>
							<id xsi:type="xs:decimal">5</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">СвУведУточ</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">5</lastId>
					<item>
						<value xsi:type="xs:string">ДатаПол</value>
						<presentation>Документ.ДатаПол</presentation>
						<id xsi:type="xs:decimal">4</id>
					</item>
					<item>
						<value xsi:type="xs:string">ВремяПол</value>
						<presentation>Документ.ВремяПол</presentation>
						<id xsi:type="xs:decimal">5</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">false</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
			</row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ЮЛ</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">8</lastId>
						<item>
							<value xsi:type="xs:string">НаимОрг</value>
							<presentation>Документ.НаимОргОТП</presentation>
							<id xsi:type="xs:decimal">6</id>
						</item>
						<item>
							<value xsi:type="xs:string">ИННЮЛ</value>
							<presentation>Документ.ИННОТП</presentation>
							<id xsi:type="xs:decimal">7</id>
						</item>
						<item>
							<value xsi:type="xs:string">КПП</value>
							<presentation>Документ.КППОТП</presentation>
							<id xsi:type="xs:decimal">8</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">ОтпрДок</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">2</lastId>
					<item>
						<value xsi:type="xs:string">ИдУчастЭДО</value>
						<presentation>Документ.xmlГрузоотправитель</presentation>
						<id xsi:type="xs:decimal">2</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">false</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
			</row>
			<row>
				<row>
					<Value xsi:type="xs:boolean">true</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="xs:string">ФИО</Value>
					<Value xsi:nil="true"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">8</lastId>
						<item>
							<value xsi:type="xs:string">Фамилия</value>
							<presentation>Документ.ФамилияПодп</presentation>
							<id xsi:type="xs:decimal">6</id>
						</item>
						<item>
							<value xsi:type="xs:string">Имя</value>
							<presentation>Документ.ИмяПодп</presentation>
							<id xsi:type="xs:decimal">7</id>
						</item>
						<item>
							<value xsi:type="xs:string">Отчество</value>
							<presentation>Документ.ОтчествоПодп</presentation>
							<id xsi:type="xs:decimal">8</id>
						</item>
					</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueTable"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:decimal">0</Value>
					<Value xsi:type="xs:boolean">false</Value>
					<Value xsi:type="xs:string"/>
					<Value xsi:type="ValueListType">
						<valueType/>
						<lastId xsi:type="xs:decimal">-1</lastId>
					</Value>
				</row>
				<Value xsi:type="xs:boolean">true</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="xs:string">Подписант</Value>
				<Value xsi:nil="true"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">14</lastId>
					<item>
						<value xsi:type="xs:string">СтатПодп</value>
						<presentation>Документ.СтатПодп</presentation>
						<id xsi:type="xs:decimal">13</id>
					</item>
					<item>
						<value xsi:type="xs:string">Должн</value>
						<presentation>Документ.ДолжнПодп</presentation>
						<id xsi:type="xs:decimal">14</id>
					</item>
				</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueTable"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:decimal">0</Value>
				<Value xsi:type="xs:boolean">false</Value>
				<Value xsi:type="xs:string"/>
				<Value xsi:type="ValueListType">
					<valueType/>
					<lastId xsi:type="xs:decimal">-1</lastId>
				</Value>
			</row>
			<Value xsi:type="xs:boolean">true</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="xs:string">Документ</Value>
			<Value xsi:nil="true"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">9</lastId>
				<item>
					<value xsi:type="xs:string">КНД</value>
					<presentation>Документ.КНД</presentation>
					<id xsi:type="xs:decimal">9</id>
				</item>
			</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="ValueTable"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
			<Value xsi:type="xs:decimal">0</Value>
			<Value xsi:type="xs:decimal">0</Value>
			<Value xsi:type="xs:boolean">false</Value>
			<Value xsi:type="xs:string"/>
			<Value xsi:type="ValueListType">
				<valueType/>
				<lastId xsi:type="xs:decimal">-1</lastId>
			</Value>
		</row>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Исходящий UVUTOCH (Уведомление об уточнении)</Value>
		<Value xsi:type="xs:string">ТекущийДокумент</Value>
		<Value xsi:type="xs:string">Файл</Value>
		<Value xsi:type="Structure">
			<Property name="Ссылка">
				<Value xsi:type="xs:string">Документ.Ссылка</Value>
			</Property>
			<Property name="ВидДокумента">
				<Value xsi:type="xs:string">Документ.ВидДокумента</Value>
			</Property>
			<Property name="Идентификатор">
				<Value xsi:type="xs:string">Документ.ИдентификаторДокумента</Value>
			</Property>
			<Property name="Номер">
				<Value xsi:type="xs:string">Документ.Номер</Value>
			</Property>
			<Property name="ФайлИмя">
				<Value xsi:type="xs:string">Документ.ИмяФайла</Value>
			</Property>
			<Property name="Организация">
				<Value xsi:type="xs:string">Документ.Организация</Value>
			</Property>
			<Property name="Грузоотправитель">
				<Value xsi:type="xs:string">Документ.Грузоотправитель</Value>
			</Property>
			<Property name="Грузоперевозчик">
				<Value xsi:type="xs:string">Документ.Грузоперевозчик</Value>
			</Property>
			<Property name="Грузополучатель">
				<Value xsi:type="xs:string">Документ.Грузополучатель</Value>
			</Property>
		</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">5</lastId>
			<item>
				<value xsi:type="xs:string">ИдФайл</value>
				<presentation>Документ.ИдФайл</presentation>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВерсПрог</value>
				<presentation>Документ.ВерсПрог</presentation>
				<id xsi:type="xs:decimal">4</id>
			</item>
			<item>
				<value xsi:type="xs:string">ВерсФорм</value>
				<presentation>Документ.ВерсФорм</presentation>
				<id xsi:type="xs:decimal">5</id>
			</item>
		</Value>
		<Value xsi:type="xs:string"> ЗапросМЧД = Новый Запрос; 
ЗапросМЧД.УстановитьПараметр("ЭтоРегламентноеЗадание", ЭтоРегламентноеЗадание); 
ЗапросМЧД.УстановитьПараметр("Пользователь", НайтиТекущегоПользователя()); 
ЗапросМЧД.УстановитьПараметр("ТекущаяДата", ТекущаяДата()); 
ЗапросМЧД.УстановитьПараметр("DR_УчастникиОбмена", DR_УчастникиОбмена.Выгрузить()); 
ЗапросМЧД.УстановитьПараметр("DR_ПрофилиОбмена", DR_ПрофилиОбмена.Выгрузить()); 
ЗапросМЧД.Текст = ТекстЗапроса_МЧД_ПоОрганизациям(); 
ТаблицаМЧД = ЗапросМЧД.Выполнить().Выгрузить();

Запрос = Новый Запрос;  
 Запрос.Текст ="ВЫБРАТЬ
               |	DR_УчастникиОбмена.Ссылка КАК Ссылка,
               |	DR_УчастникиОбмена.GUID КАК GUID,
               |	DR_УчастникиОбмена.Роль КАК Роль,
               |	DR_УчастникиОбмена.ПоддерживаетМЧД КАК ОтправитьМЧД
               |ПОМЕСТИТЬ DR_УчастникиОбмена
               |ИЗ
               |	&amp;DR_УчастникиОбмена КАК DR_УчастникиОбмена
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	DR_ДокументыДополнительныеРеквизиты.Ссылка КАК Ссылка,
               |	DR_ДокументыДополнительныеРеквизиты.Реквизит КАК Реквизит,
               |	DR_ДокументыДополнительныеРеквизиты.Значение КАК Значение
               |ПОМЕСТИТЬ DR_ДополнительныеРеквизиты
               |ИЗ
               |	Документ.DR_Документы.ДополнительныеРеквизиты КАК DR_ДокументыДополнительныеРеквизиты
               |ГДЕ
               |	DR_ДокументыДополнительныеРеквизиты.Ссылка В(&amp;Документ)
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	DR_Документ.Ссылка КАК DR_Документ,
               |	Организация_GUID.Значение КАК Организация,
               |	Грузоотправитель_GUID.Значение КАК Грузоотправитель,
               |	Грузоперевозчик_GUID.Значение КАК Грузоперевозчик,
               |	Грузополучатель_GUID.Значение КАК Грузополучатель
               |ПОМЕСТИТЬ ВТ_DRДокументУчастники
               |ИЗ
               |	Документ.DR_Документы КАК DR_Документ
               |		ЛЕВОЕ СОЕДИНЕНИЕ DR_ДополнительныеРеквизиты КАК Организация_GUID
               |		ПО DR_Документ.Ссылка = Организация_GUID.Ссылка
               |			И (Организация_GUID.Реквизит = ""Организация"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ DR_ДополнительныеРеквизиты КАК Грузоотправитель_GUID
               |		ПО DR_Документ.Ссылка = Грузоотправитель_GUID.Ссылка
               |			И (Грузоотправитель_GUID.Реквизит = ""Грузоотправитель"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ DR_ДополнительныеРеквизиты КАК Грузоперевозчик_GUID
               |		ПО DR_Документ.Ссылка = Грузоперевозчик_GUID.Ссылка
               |			И (Грузоперевозчик_GUID.Реквизит = ""Грузоперевозчик"")
               |		ЛЕВОЕ СОЕДИНЕНИЕ DR_ДополнительныеРеквизиты КАК Грузополучатель_GUID
               |		ПО DR_Документ.Ссылка = Грузополучатель_GUID.Ссылка
               |			И (Грузополучатель_GUID.Реквизит = ""Грузополучатель"")
               |ГДЕ
               |	DR_Документ.Ссылка В(&amp;Документ)
               |;
               |
               |////////////////////////////////////////////////////////////////////////////////
               |ВЫБРАТЬ
               |	DR_Документы.Ссылка КАК Ссылка,
               |	DR_Документы.Ссылка.Номер КАК Номер,
               |	DR_Документы.Ссылка.ИдентификаторДокумента КАК ИдентификаторДокумента,
               |	""DP_UVUTOCH_Исходящий"" КАК ВидДокумента,
               |	ВТ_DRДокументУчастники.Организация КАК Организация,
               |	ВТ_DRДокументУчастники.Грузоотправитель КАК Грузоотправитель,
               |	ВТ_DRДокументУчастники.Грузоперевозчик КАК Грузоперевозчик,
               |	ВТ_DRДокументУчастники.Грузополучатель КАК Грузополучатель,
               |	DR_Документы.Дата КАК Дата,
               |	DR_Документы.Сообщение КАК ТекстУведУточ,
               |	DR_УчастникиОбмена.ОтправитьМЧД КАК ОтправитьМЧД
               |ИЗ
               |	Документ.DR_Документы КАК DR_Документы
               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_DRДокументУчастники КАК ВТ_DRДокументУчастники
               |			ЛЕВОЕ СОЕДИНЕНИЕ DR_УчастникиОбмена КАК DR_УчастникиОбмена
               |			ПО (ВТ_DRДокументУчастники.Организация = DR_УчастникиОбмена.Ссылка
               |					И DR_УчастникиОбмена.Роль = ""Грузоперевозчик"")
               |		ПО (DR_Документы.Ссылка = ВТ_DRДокументУчастники.DR_Документ)
               |ГДЕ
               |	DR_Документы.Ссылка В (&amp;Документ)";

 Запрос.УстановитьПараметр("Документ", Источник);
 Запрос.УстановитьПараметр("DR_УчастникиОбмена", DR_УчастникиОбмена.Выгрузить()); 
 РезультатЗапроса = Запрос.Выполнить(); 
 Результат = РезультатЗапроса.Выгрузить();

 
 Результат.Колонки.Добавить("ИдФайл"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ИмяФайла"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ВерсПрог"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ВерсФорм"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("КНД"					, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("УИдТрН"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ИдУчастЭДО"			, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("НаимОргПЕР"			, Новый ОписаниеТипов("Строка")); 
 Результат.Колонки.Добавить("ИННПЕР"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("КПППЕР"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ДатаПол"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ВремяПол"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ИдентификаторОснования", Новый ОписаниеТипов("Строка")); //ИмяПостФайла
 Результат.Колонки.Добавить("ЭППолФайл"				, Новый ОписаниеТипов("Строка")); 
 Результат.Колонки.Добавить("НаимДок"				, Новый ОписаниеТипов("Строка")); 
 Результат.Колонки.Добавить("ТранспортнаяНакладнаяНомер" , Новый ОписаниеТипов("Строка")); 
 Результат.Колонки.Добавить("ТранспортнаяНакладнаяДата"	 , Новый ОписаниеТипов("Дата")); 
 Результат.Колонки.Добавить("ОтпИдУчастЭДО"			, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("НаимОргОТП"			, Новый ОписаниеТипов("Строка")); 
 Результат.Колонки.Добавить("ИННОТП"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("КППОТП"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("НомСФ"					, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ДатаСФ"				, Новый ОписаниеТипов("Строка"));   
 Результат.Колонки.Добавить("xmlГрузоотправитель"	, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("xmlГрузоперевозчик"	, Новый ОписаниеТипов("Строка"));
 
 Результат.Колонки.Добавить("СтатПодп"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ДолжнПодп"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ФамилияПодп"			, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ИмяПодп"				, Новый ОписаниеТипов("Строка"));
 Результат.Колонки.Добавить("ОтчествоПодп"			, Новый ОписаниеТипов("Строка")); 
 
 //МЧД
Результат.Колонки.Добавить("Сертификат");
Результат.Колонки.Добавить("СтрокаМЧД");
Результат.Колонки.Добавить("GUIDФайла"); 
 
 Для Каждого Строка из Результат Цикл
	 
	 ПустойUTC = "+00:00";
	 
	 //Заполняем данные из ТЧ дополнительные реквизиты
	 Для каждого СтрокаРеквизит Из Строка.Ссылка.ДополнительныеРеквизиты Цикл
	 	Попытка
	 		Строка[СтрокаРеквизит.Реквизит] = СтрокаРеквизит.Значение;
	 	Исключение
	 		//Колонки нет
	 	КонецПопытки;
	 КонецЦикла;	 
	 
	 
	 ИдентификаторФайла        = Строка.ИдентификаторДокумента;
	 //Общие данные
	 Строка.ВерсФорм 		= "1.03";
	 Строка.ВерсПрог 		= "Docrobot 1C";
	 Строка.ИдФайл 			= ИдентификаторФайла;  
	 Строка.ИмяФайла 		= ИдентификаторФайла+".xml";
	 Строка.КНД 			= "1115113";
	 Строка.НаимДок 		= "Транспортная накладная, информация грузоотправителя";  
	 Строка.НаимОргПЕР      = Строка.Грузоперевозчик.Наименование;
	 Строка.ИННПЕР			= Строка.Грузоперевозчик.ИНН;
	 Строка.КПППЕР			= Строка.Грузоперевозчик.КПП;
	 Строка.НаимОргОТП      = Строка.Грузоотправитель.Наименование;
	 Строка.ИННОТП			= Строка.Грузоотправитель.ИНН;
	 Строка.КППОТП			= Строка.Грузоотправитель.КПП; 
	 
	 Строка.ДатаПол			= Формат(Строка.Дата,"ДФ=dd.MM.yyyy");
	 Строка.ВремяПол		= Формат(Строка.Дата,"ДФ=чч.мм.сс"); 
	 Строка.НомСФ			= Строка.ТранспортнаяНакладнаяНомер;
	 Строка.ДатаСФ			= Формат(Строка.ТранспортнаяНакладнаяДата,"ДФ=dd.MM.yyyy");
	
	 //Получаем текст подписи из файла BIN 
	ДвоичныеДанныеBIN = Строка.Ссылка.ДанныеЭЦП.Получить();
	//ВременныйКаталог = ПутьВременногоКаталога_DR();		
	//ПутьКФайлу 		 = ВременныйКаталог + "Подпись_" + Строка.Номер + ".bin"; //Формат(ТекущаяДата(), "ДФ=yyyyMMddHHmmss") + ".bin"; 
	//ДвоичныеДанныеBIN.Записать(ПутьКФайлу);	
	//Текст = Новый ТекстовыйДокумент;
	//Текст.Прочитать(ПутьКФайлу);		
	//Строка.ЭППолФайл = Текст.ПолучитьТекст();	
	
	//Попытка
	//	УдалитьФайлы(ПутьКФайлу);
	//Исключение
	//КонецПопытки;	
	
	//Альтернативный способ получения подписи, для сертификатов хранящихся в формате base64
	
	ПодписьBase64 = Base64Строка(ДвоичныеДанныеBIN);  
	ПодписьBase64 = СтрЗаменить(ПодписьBase64, Символы.ПС, "");
	ПодписьBase64 = СтрЗаменить(ПодписьBase64, Символы.ВК, "");
	Строка.ЭППолФайл = ПодписьBase64;
	 
	 //////////////////////МЧД//////////////////////
    СтрокаПоМЧД = ТаблицаМЧД.Найти(Строка.Организация, "Организация");
	Если СтрокаПоМЧД &lt;&gt; Неопределено И СтрокаПоМЧД.Организация_ПоддерживаетМЧД = Истина И Строка.ОтправитьМЧД = Истина Тогда 

		Если СтрокаПоМЧД.Сертификат = Null ИЛИ СтрокаПоМЧД.ТипСертификата = 2 И (НЕ ЗначениеЗаполнено(СтрокаПоМЧД.СтрокаМЧД) ИЛИ НЕ СтрокаПоМЧД.МЧД_Актуальна) Тогда  
	        ТекстЛогаСобытий = "Проверьте наличие доверенности для пользователя по организации " + Строка.Организация;
	        //ЗаписатьЛогСобытий(ЛогСобытий, ТекстЛогаСобы&lt;&gt;ий);
			
			//Результат.Удалить(Строка);
			
			ЗаписьСтруктурыЛога = ЗаполненнаяЗаписьЛога(ТекстЛогаСобытий, "Ошибка", "Выполнение ГН исходящие");
			МассивЛогаСобытий.Добавить(ЗаписьСтруктурыЛога);
			
        	Продолжить;
		КонецЕсли; 
		Если СтрокаПоМЧД.ТипСертификата = 2 Тогда	
			Строка.ОтправитьМЧД = Истина;
	    	Строка.СтрокаМЧД 	= СтрокаПоМЧД.СтрокаМЧД;  
			ПодписантТип                    = "ФЛ";  
		Иначе
			ПодписантТип                    = "ЮЛ"; //ВыборкаДокумента.ОрганизацияЮрФизЛицо;
		КонецЕсли;	
		
		Строка.Сертификат 				= СтрокаПоМЧД.Сертификат; 
		
		ДолжностьПодписанта             = СтрокаПоМЧД.ДолжностьПодписанта;
		ФамилияПодписанта               = СтрокаПоМЧД.ФамилияПодписанта;
		ИмяПодписанта                   = СтрокаПоМЧД.ИмяПодписанта;
		ОтчествоПодписанта              = СтрокаПоМЧД.ОтчествоПодписанта;
		СертификатОбластьПолномочий    	= СтрокаПоМЧД.ОбластьПолномочий;
		СертификатОснованиеПолномочий   = СтрокаПоМЧД.ОснованиеПолномочий;
		СертификатСтатусПодписанта      = СтрокаПоМЧД.СтатусПодписанта;
		ОргПодписантИНН                 = СтрокаПоМЧД.СертификатИНН;
		ОтпечатокСертификата			= СтрокаПоМЧД.ОтпечатокСертификата;
		
		МассивGUID = DR_СтрРазделить(ИдентификаторФайла,"_");
		Строка.GUIDФайла = МассивGUID[МассивGUID.Количество()-1];
		
	Иначе           
		ДанныеПоОрганизации = DR_GLN_Прочитать(Строка.Организация, "Грузоперевозчик");
		Сертификат 						= ДанныеПоОрганизации.Сертификат;
		Строка.Сертификат 				= Сертификат; 
		
		ДолжностьПодписанта             = Сертификат.ДолжностьПодписанта;
		ФамилияПодписанта               = Сертификат.ФамилияПодписанта;
		ИмяПодписанта                   = Сертификат.ИмяПодписанта;
		ОтчествоПодписанта              = Сертификат.ОтчествоПодписанта;
		СертификатОбластьПолномочий    	= Сертификат.ОбластьПолномочий;
		СертификатОснованиеПолномочий   = Сертификат.ОснованиеПолномочий;
		СертификатСтатусПодписанта      = Сертификат.СтатусПодписанта;
		ОргПодписантИНН                 = Сертификат.ИНН;  
		ПодписантТип                    = Сертификат.ТипСертификата; 
		ОтпечатокСертификата			= Сертификат.ОтпечатокСертификата;
	КонецЕсли;
 
     
	 
	 //Сведения о Подписанте
	 Попытка
		 
		 //Сертификат = ДанныеПоОрганизации.Сертификат;
		 Строка.СтатПодп			= СертификатСтатусПодписанта;
		 Строка.ДолжнПодп			= ДолжностьПодписанта;
		 Строка.ФамилияПодп			= ФамилияПодписанта;
		 Строка.ИмяПодп				= ИмяПодписанта;
		 Строка.ОтчествоПодп		= ОтчествоПодписанта;
		// Строка.ЭП					= ОтпечатокСертификата;	
	 Исключение
	 КонецПопытки;	
	 
 КонецЦикла;
 
 Возврат Результат;</Value>
		<Value xsi:type="ValueTable"/>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">0</lastId>
			<item>
				<value xsi:type="xs:string">НомерПоПорядку</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
		</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">-1</lastId>
		</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:decimal">0</Value>
		<Value xsi:type="xs:boolean">true</Value>
		<Value xsi:type="xs:string">Отменить ЭТрН</Value>
		<Value xsi:type="ValueListType">
			<valueType/>
			<lastId xsi:type="xs:decimal">4</lastId>
			<item>
				<value xsi:type="xs:string">ДополнительныйПолучатель</value>
				<id xsi:type="xs:decimal">0</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоперевозчик</value>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">1</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузополучатель</value>
				<id xsi:type="xs:decimal">2</id>
			</item>
			<item>
				<value xsi:type="xs:string">Грузоотправитель</value>
				<id xsi:type="xs:decimal">3</id>
			</item>
			<item>
				<value xsi:type="xs:string">ИмяКнопки</value>
				<presentation>Отменить ЭТрН</presentation>
				<checkState>1</checkState>
				<id xsi:type="xs:decimal">4</id>
			</item>
		</Value>
	</row>
</ValueTree>